<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Herramienta de An√°lisis - Cronograf√≠as</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* ESTILOS BASE */
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background-color: #ffffff !important; 
            overflow: hidden; color: #333; 
        }

        #main-wrapper {
            position: relative; width: 100%; height: 100vh;
            display: flex; flex-direction: column;
        }

        canvas { 
            display: block; width: 100%; height: 100%; 
            position: absolute; top: 0; left: 0; z-index: 0;
        }
        
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none; 
        }

        /* HEADER */
        .header-container {
            width: 100%; display: flex; justify-content: center;
            padding-top: 10px; pointer-events: auto;
        }
        .title-box {
            text-align: center; background: rgba(255,255,255,0.85);
            padding: 5px 15px; border-radius: 15px; backdrop-filter: blur(2px);
        }
        .title-box h1 { margin: 0; font-size: 1.5rem; font-weight: 800; color: #2d3436; text-transform: uppercase; }
        .title-box h2 { margin: 0; font-size: 0.85rem; font-weight: 500; color: #636e72; }

        /* CONTROLES */
        .controls-area {
            position: absolute; top: 15px; left: 15px; display: flex; gap: 5px; pointer-events: auto;
        }
        .speed-btn {
            background: #f1f2f6; color: #636e72; border: 1px solid #ced6e0;
            padding: 6px 12px; border-radius: 15px; cursor: pointer; font-size: 0.75rem; font-weight: bold;
        }
        .speed-btn.active { background: #74b9ff; color: white; border-color: #74b9ff; }

        #clock {
            position: absolute; top: 15px; right: 15px;
            font-size: 1.8rem; font-weight: 800; background: rgba(255,255,255,0.9); color: #2d3436;
            padding: 2px 15px; border-radius: 12px; border: 1px solid #dfe6e9; pointer-events: auto;
        }

        /* FOOTER */
        .footer-info { position: absolute; bottom: 10px; left: 15px; pointer-events: auto; }
        .author-badge {
            background: rgba(255,255,255,0.9); border: 1px solid #dfe6e9;
            padding: 5px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; color: #0984e3;
        }

        /* ETIQUETAS */
        .label {
            position: absolute; font-size: 0.65rem; font-weight: bold; color: #636e72;
            border: 1px solid rgba(0,0,0,0.1); width: 85px; height: 55px; border-radius: 10px;
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; 
            pointer-events: none; background: rgba(255,255,255,0.7); padding: 2px;
            transform: translate(-50%, -50%); transition: top 0.3s, left 0.3s; z-index: 5;
        }
        .pct-indicator { font-size: 0.8rem; color: #0984e3; margin-top: 1px; }
        .label.center-activity { 
            width: 100px; height: 100px; border-radius: 50%;
            border: 2px dashed #b2bec3; background: rgba(245, 245, 245, 0.5); font-size: 0.8rem; color: #2d3436;
        }
        .label.center-activity .pct-indicator { font-size: 1.1rem; font-weight: 800; }

        /* --- ESTILOS DE LA CAJA NEGRA (MODAL) --- */
        #data-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98); z-index: 2000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .modal-content {
            background: #fff; padding: 20px; border-radius: 15px; width: 90%; max-width: 800px;
            text-align: center; border: 1px solid #eee; height: 70vh; display: flex; flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        textarea {
            width: 100%; flex-grow: 1; background: #f8f9fa; color: #2d3436; border: 1px solid #dfe6e9;
            padding: 10px; font-family: 'Consolas', monospace; margin-top: 10px; font-size: 0.75rem; border-radius: 5px;
            white-space: pre; overflow: auto;
        }
        button.start-btn {
            background: #74b9ff; color: white; border: none; padding: 12px 40px;
            font-size: 1.1rem; margin-top: 20px; cursor: pointer; border-radius: 50px;
            font-weight: bold; transition: all 0.2s; box-shadow: 0 4px 10px rgba(116, 185, 255, 0.4);
        }
        button.start-btn:hover { background: #0984e3; transform: scale(1.05); }

        /* Tooltip */
        #tooltip {
            position: absolute; display: none; background: rgba(255, 255, 255, 0.98);
            border: 1px solid #dfe6e9; color: #2d3436; padding: 10px;
            border-radius: 8px; pointer-events: none; z-index: 1000; font-size: 0.85rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15); left: 50%; top: 50%; transform: translate(-50%, -50%);
        }

        @media (max-width: 768px) {
            .title-box h1 { font-size: 1rem; } .title-box h2 { display: none; } 
            #clock { font-size: 1.2rem; top: 50px; right: 50%; transform: translateX(50%); background: rgba(255,255,255,0.6); }
            .controls-area { top: 50px; left: 10px; transform: scale(0.8); transform-origin: left top; }
            .label { width: 60px; height: 40px; font-size: 0.5rem; background: rgba(255,255,255,0.6); }
            .label.center-activity { width: 70px; height: 70px; font-size: 0.6rem; }
            .author-badge { font-size: 0.6rem; padding: 3px 8px; bottom: 5px; left: 5px;}
        }
    </style>
</head>
<body>

<div id="data-modal">
    <div class="modal-content">
        <h2 style="margin: 0 0 10px 0; color:#2d3436">üìä Carga de Datos</h2>
        <p style="color: #636e72; margin: 0 0 10px 0; font-size: 0.9rem;">
            Pega tu CSV aqu√≠ para visualizarlo.
        </p>
<textarea id="csv-input">
ID,Grupo ,G√©nero,00:00,00:30,01:00,01:30,02:00,02:30,03:00,03:30,04:00,04:30,05:00,05:30,06:00,06:30,07:00,07:30,08:00,08:30,09:00,09:30,10:00,10:30,11:00,11:30,12:00,12:30,13:00,13:30,14:00,14:30,15:00,15:30,16:00,16:30,17:00,17:30,18:00,18:30,19:00,19:30,20:00,20:30,21:00,21:30,22:00,22:30,23:00,23:30
1,Econom√≠a,Mujer,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Preparar alimentos,Tareas del hogar,Tareas del hogar,Tareas del hogar,Ejercicio y/o deporte,Ejercicio y/o deporte,Tareas y estudio,Tareas y estudio,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Convivir con familia,Convivir con familia,Tareas y estudio,Tareas y estudio,Preparar alimentos,Comer y beber,Convivir con familia,Convivir con familia,Preparar alimentos,Comer y beber,Otras actividades,Otras actividades,Otras actividades,Otras actividades,Dormir,Dormir
2,Economia,Mujer,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Traslado,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comer y beber,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Socializar,Traslado,Traslado,Comer y beber,Convivir con familia,Entretenimiento,Tareas del hogar,Entretenimiento,Convivir con familia,Entretenimiento,Entretenimiento,Cuidado personal,Tareas y estudio,Tareas y estudio,Tareas y estudio,Entretenimiento,Tareas y estudio,Tareas y estudio,Tareas y estudio,Dormir
3,Econom√≠a,Mujer,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Cuidado personal,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Comer y beber,Convivir con familia,Cuidado personal,Entretenimiento,Entretenimiento,Entretenimiento,Entretenimiento,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Otras actividades,Preparar alimentos,Comer y beber,Entretenimiento,Entretenimiento,Tareas y estudio
4,Econom√≠a,Mujer,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comer y beber,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Tareas del hogar,Preparar alimentos,Comer y beber,Cuidado personal,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Traslado,Cuidado personal,Convivir con familia,Preparar alimentos,Comer y beber,Tareas y estudio,Tareas y estudio,Tareas y estudio,Dormir
5,Econom√≠a,Hombre,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Comer y beber,Cuidado personal,Traslado,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Traslado,Cuidado personal,Cuidado personal,Traslado,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Otras actividades,Otras actividades,Otras actividades,Otras actividades,Traslado,Convivir con familia,Convivir con familia,Comer y beber,Cuidado personal,Entretenimiento,Entretenimiento,Entretenimiento,Entretenimiento,Dormir,Dormir
6,Econom√≠a,Mujer,Tareas y estudio,Tareas y estudio,Entretenimiento,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Preparar alimentos,Comer y beber,Tareas del hogar,Dormir,Entretenimiento,Clases extracurriculares,Clases extracurriculares,Clases extracurriculares,Clases extracurriculares,Clases extracurriculares,Traslado,Socializar,Comprar comida,Entretenimiento,Tareas y estudio,Tareas y estudio,Tareas y estudio,Entretenimiento,Tareas y estudio
7,Econom√≠a,Hombre,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Comer y beber,Traslado,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Entretenimiento,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Comprar comida,Comer y beber,Cuidado personal,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Cuidado personal,Comer y beber,Tareas y estudio,Tareas y estudio,Tareas y estudio,Dormir
8,Econom√≠a,Hombre,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Convivir con familia,Convivir con familia,Convivir con familia,Tareas del hogar,Tareas del hogar,Tareas y estudio
9,Econom√≠a,Mujer,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Comer y beber,Traslado,Traslado,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comer y beber,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Traslado,Traslado,Comer y beber,Tareas y estudio,Tareas y estudio,Otras actividades,Cuidado personal,Otras actividades,Otras actividades,Otras actividades,Religi√≥n,Religi√≥n,Convivir con familia,Preparar alimentos,Comer y beber,Convivir con familia,Otras actividades,Otras actividades,Dormir,Dormir
10,Econom√≠a,Hombre,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Preparar alimentos,Cuidado personal,Traslado,Traslado,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Traslado,Traslado,Comer y beber,Tareas del hogar,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Cuidado personal,Comer y beber,Entretenimiento,Entretenimiento,Dormir,Dormir,Dormir,Dormir,Dormir
11,Econom√≠a,Hombre,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Comer y beber,Traslado,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Preparar alimentos,Comer y beber,Convivir con familia,Cuidado personal,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Tareas del hogar,Convivir con familia,Entretenimiento,Comer y beber,Otras actividades,Entretenimiento,Dormir,Dormir,Dormir,Dormir
12,Econom√≠a,Hombre,Entretenimiento,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Preparar alimentos,Comer y beber,Traslado,Traslado,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Traslado,Traslado,Preparar alimentos,Comer y beber,Tareas del hogar,Tareas y estudio,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Tareas y estudio,Tareas y estudio,Preparar alimentos,Comer y beber,Entretenimiento,Convivir con familia,Entretenimiento,Ejercicio y/o deporte,Ejercicio y/o deporte,Socializar
13,Econom√≠a,Hombre,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Otras actividades,Preparar alimentos,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Otras actividades,Otras actividades,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Preparar alimentos,Comer y beber,Comer y beber,Tareas del hogar,Tareas del hogar,Tareas del hogar,Tareas del hogar,Trabajar,Trabajar,Trabajar,Trabajar,Cuidado personal,Entretenimiento,Entretenimiento,Dormir,Dormir
14,Econom√≠a,Hombre,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Preparar alimentos,Comer y beber,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Traslado,Comprar comida,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Trabajar,Trabajar,Trabajar,Trabajar,Traslado,Comer y beber,Cuidado personal,Tareas y estudio,Tareas y estudio,Otras actividades,Otras actividades,Traslado,Socializar,Traslado,Comer y beber,Cuidado personal,Convivir con familia,Entretenimiento,Dormir,Dormir
15,Econom√≠a,Hombre,Cuidado personal,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Tareas del hogar,Tareas del hogar,Preparar alimentos,Cuidado personal,Cuidado personal,Traslado,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comer y beber,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Traslado,Tareas del hogar,Convivir con familia,Entretenimiento,Tareas y estudio,Tareas y estudio,Tareas y estudio
16,Economia,Mujer,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Traslado,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Traslado,Traslado,Trabajar,Trabajar,Trabajar,Trabajar,Comer y beber,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comer y beber,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Cuidado personal,Tareas y estudio,Dormir,Dormir
17,Economia,Mujer,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Preparar alimentos,Cuidado personal,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Tareas del hogar,Tareas y estudio,Tareas y estudio,Preparar alimentos,Comer y beber,Cuidado personal,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Traslado,Preparar alimentos,Comer y beber,Cuidado personal,Tareas y estudio,Tareas y estudio,Tareas del hogar,Entretenimiento,Dormir
18,Economia,Mujer,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Cuidado personal,Traslado,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comer y beber,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Preparar alimentos,Comer y beber,Dormir,Dormir,Tareas del hogar,Entretenimiento,Cuidado personal,Entretenimiento,Entretenimiento,Entretenimiento,Entretenimiento,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir
19,Economia,Mujer,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Comer y beber,Traslado,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comprar comida,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Tareas y estudio,Tareas y estudio,Tareas y estudio,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Traslado,Comprar comida,Comer y beber,Tareas y estudio,Tareas y estudio,Tareas y estudio
20,Economia,Mujer,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Cuidado personal,Comer y beber,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Traslado,Traslado,Preparar alimentos,Preparar alimentos,Comer y beber,Convivir con familia,Tareas del hogar,Tareas del hogar,Convivir con familia,Entretenimiento,Entretenimiento,Tareas y estudio,Tareas y estudio,Tareas y estudio,Preparar alimentos,Comer y beber,Convivir con familia,Dormir,Dormir
21,Economia,Hombre,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Entretenimiento,Entretenimiento,Entretenimiento,Convivir con familia,Comer y beber,Dormir,Dormir,Tareas y estudio,Tareas y estudio,Tareas y estudio,Socializar,Socializar,Socializar,Socializar,Socializar,Socializar,Socializar,Socializar,Socializar,Socializar,Socializar
22,Economia,Mujer,Entretenimiento,Entretenimiento,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Traslado,Traslado,Cuidado personal,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comer y beber,Socializar,Socializar,Traslado,Tareas del hogar,Tareas y estudio,Tareas y estudio,Comer y beber,Cuidado personal,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comer y beber,Otras actividades,Otras actividades,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Comer y beber,Tareas y estudio,Tareas y estudio,Tareas y estudio,Entretenimiento,Dormir
23,Economia,Hombre,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Traslado,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Tareas y estudio,Tareas y estudio,Comer y beber,Comer y beber,Tareas del hogar,Tareas del hogar,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Traslado,Preparar alimentos,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio
24,Economia,Mujer,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Cuidado personal,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Preparar alimentos,Comer y beber,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Cuidado personal,Preparar alimentos,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comer y beber,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Entretenimiento,Comer y beber,Otras actividades,Otras actividades,Entretenimiento,Entretenimiento,Dormir
25,Economia,Hombre,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Cuidado personal,Traslado,Tareas del hogar,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Traslado,Traslado,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Traslado,Cuidado personal,Preparar alimentos,Comer y beber,Tareas del hogar,Tareas y estudio,Tareas y estudio,Entretenimiento,Entretenimiento,Entretenimiento,Entretenimiento,Entretenimiento,Entretenimiento,Entretenimiento,Entretenimiento,Dormir
26,Economia,Mujer,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Preparar alimentos,Cuidado personal,Comer y beber,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Preparar alimentos,Comer y beber,Comer y beber,Entretenimiento,Entretenimiento,Tareas y estudio,Tareas y estudio,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Clases extracurriculares,Clases extracurriculares,Clases extracurriculares,Otras actividades,Otras actividades,Comer y beber,Pagar cuentas,Cuidado personal,Entretenimiento
27,Economia,Hombre,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Cuidado personal,Preparar alimentos,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comer y beber,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Traslado,Comer y beber,Convivir con familia,Otras actividades,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Ejercicio y/o deporte,Traslado,Cuidado personal,Tareas y estudio,Tareas y estudio,Preparar alimentos,Comer y beber,Tareas y estudio,Dormir
28,Economia,Hombre,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Traslado,Comer y beber,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Trabajar,Traslado,Convivir con familia,Convivir con familia,Traslado,Traslado,Comer y beber,Comer y beber,Entretenimiento,Entretenimiento,Entretenimiento,Entretenimiento,Entretenimiento,Entretenimiento,Entretenimiento,Preparar alimentos,Comer y beber,Comer y beber,Entretenimiento,Entretenimiento,Dormir,Dormir
29,Economia,Hombre,Cuidado personal,Cuidado personal,Comer y beber,Entretenimiento,Entretenimiento,Entretenimiento,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Socializar,Socializar,Traslado,Traslado,Comer y beber,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Convivir con familia,Convivir con familia,Entretenimiento,Entretenimiento,Tareas y estudio,Tareas y estudio,Tareas y estudio,Comer y beber,Tareas y estudio,Entretenimiento
30,Economia,Hombre,Cuidado personal,Cuidado personal,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Cuidado personal,Preparar alimentos,Traslado,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Traslado,Comer y beber,Dormir,Dormir,Entretenimiento,Comer y beber,Comer y beber,Entretenimiento,Entretenimiento,Entretenimiento,Cuidado personal,Entretenimiento,Preparar alimentos,Comer y beber,Comer y beber,Comer y beber,Otras actividades,Dormir,Convivir con familia,Dormir,Dormir
31,Economia,Hombre,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Tareas y estudio,Tareas y estudio,Comer y beber,Otras actividades,Tareas del hogar,Tareas del hogar,Tareas del hogar,Convivir con familia,Convivir con familia,Convivir con familia,Comer y beber,Traslado,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Traslado,Traslado,Traslado,Comer y beber,Convivir con familia,Tareas y estudio
32,Economia,Hombre,Tareas y estudio,Tareas y estudio,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Preparar alimentos,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comprar comida,Traslado,Tareas del hogar,Tareas del hogar,Comer y beber,Comer y beber,Entretenimiento,Entretenimiento,Ejercicio y/o deporte,Comer y beber,Tareas y estudio,Tareas y estudio,Otras actividades,Otras actividades,Preparar alimentos,Comer y beber,Convivir con familia,Comer y beber,Entretenimiento,Entretenimiento,Tareas y estudio
33,Economia,Hombre,Dormir,Dormir,Dormir,Dormir,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio,Comer y beber,Tareas y estudio,Tareas y estudio,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comer y beber,Comer y beber,Clases en la facultad,Tareas y estudio,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Traslado,Comer y beber,Tareas y estudio,Tareas y estudio,Tareas y estudio,Tareas y estudio
34,Economia,Mujer,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Dormir,Preparar alimentos,Cuidado personal,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comer y beber,Otras actividades,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Comer y beber,Comer y beber,Otras actividades,Otras actividades,Clases en la facultad,Clases en la facultad,Tareas del hogar,Tareas y estudio,Entretenimiento,Entretenimiento,Cuidado personal,Tareas y estudio,Tareas y estudio,Tareas y estudio,Entretenimiento,Dormir
35,Economia,Mujer,Cuidado personal,Preparar alimentos,Entretenimiento,Entretenimiento,Otras actividades,Otras actividades,Otras actividades,Dormir,Dormir,Dormir,Dormir,Cuidado personal,Cuidado personal,Traslado,Clases en la facultad,Clases en la facultad,Clases en la facultad,Clases en la facultad,Tareas y estudio,Clases en la facultad,Clases en la facultad,Comer y beber,Comer y beber,Traslado,Tareas del hogar,Tareas del hogar,Cuidado personal,Traslado,Clases en la facultad,Tareas y estudio,Clases en la facultad,Clases en la facultad,Clases en la facultad,Traslado,Convivir con familia,Convivir con familia,Convivir con familia,Cuidado personal,Tareas del hogar,Tareas del hogar,Convivir con familia,Convivir con familia,Convivir con familia,Entretenimiento,Entretenimiento,Co
</textarea>
        <button class="start-btn" onclick="startSimulation()">‚ñ∂ Iniciar Visualizaci√≥n</button>
    </div>
</div>

<div id="main-wrapper">
    <div id="ui-layer">
        <div class="header-container">
            <div class="title-box">
                <h1>Cronograf√≠as Universitarias</h1>
                <h2>Visualizaci√≥n de patrones de uso del tiempo</h2>
            </div>
        </div>
        <div class="controls-area">
            <div id="speed-controls">
                <button class="speed-btn" onclick="setSpeed(200, this)">Lento</button>
                <button class="speed-btn active" onclick="setSpeed(60, this)">Medio</button>
                <button class="speed-btn" onclick="setSpeed(15, this)">R√°pido</button>
            </div>
        </div>
        <div id="clock">06:00</div>
        <div id="labels-container"></div> 
        <div class="footer-info">
            <div class="author-badge">Elaborado por: Adri√°n Eduardo Pech Quijano</div>
        </div>
    </div>
    <div id="tooltip"></div>
    <canvas id="simulation"></canvas>
</div>

<script>
    // --- MODO DEMO: Pon 'true' para multiplicar puntos (demo visual)
    // Pon 'false' para 1 a 1 (an√°lisis real)
    const MODO_DEMO = false; 

    // --- CONFIGURACI√ìN ---
    const canvas = document.getElementById("simulation");
    const context = canvas.getContext("2d", { alpha: false });
    let width, height;

    function resizeCanvas() {
        width = window.innerWidth || document.documentElement.clientWidth;
        height = window.innerHeight || document.documentElement.clientHeight;
        canvas.width = width; canvas.height = height;
        createLabels(); 
    }
    window.addEventListener('resize', resizeCanvas);

    // --- MAPA DE ACTIVIDADES ---
    const centers = {
        "Traslado": { x: 0.50, y: 0.55 }, "Dormir": { x: 0.15, y: 0.25 },
        "Cuidado personal": { x: 0.32, y: 0.25 }, "Preparar alimentos": { x: 0.50, y: 0.25 },
        "Comer y beber": { x: 0.68, y: 0.25 }, "Tareas del hogar": { x: 0.85, y: 0.25 },
        "Socializar": { x: 0.10, y: 0.85 }, "Convivir con familia": { x: 0.26, y: 0.85 }, 
        "Entretenimiento": { x: 0.42, y: 0.85 }, "Ejercicio y/o deporte": { x: 0.58, y: 0.85 },
        "Clases extracurriculares": { x: 0.74, y: 0.85 }, "Otras actividades": { x: 0.90, y: 0.85 },
        "Pagar cuentas": { x: 0.10, y: 0.55 }, "Comprar comida": { x: 0.25, y: 0.55 },
        "Religi√≥n": { x: 0.15, y: 0.70 }, "Clases en la facultad": { x: 0.85, y: 0.45 },
        "Trabajar": { x: 0.75, y: 0.55 }, "Tareas y estudio": { x: 0.85, y: 0.68 }
    };

    function createLabels() {
        const container = document.getElementById('labels-container');
        if(!container) return; container.innerHTML = ''; 
        Object.keys(centers).forEach(key => {
            const div = document.createElement('div');
            div.className = 'label';
            if (key === "Traslado") div.classList.add("center-activity");
            div.style.left = (centers[key].x * width) + 'px';
            div.style.top = (centers[key].y * height) + 'px';
            const safeId = key.replace(/\s+/g, '-').toLowerCase();
            div.innerHTML = `<div>${key}</div><div id="pct-${safeId}" class="pct-indicator">0%</div>`;
            container.appendChild(div);
        });
    }

    let nodes = [];
    let simulation;
    let clockInterval; 
    let time = 360; 
    const pastelColors = ["#ff7675", "#74b9ff", "#55efc4", "#ffeaa7", "#a29bfe", "#fd79a8", "#fab1a0", "#81ecec"];
    const colorScale = d3.scaleOrdinal(pastelColors); 

    function parseCSV(csvText) {
        const lines = csvText.trim().split(/\r?\n/);
        const headers = lines[0].split(',').map(h => h.trim());
        const parsedNodes = [];
        const toMin = (t) => {
            if(!t) return 0;
            const parts = t.trim().split(':');
            if(parts.length < 2) return 0;
            return (parseInt(parts[0]) * 60) + parseInt(parts[1]);
        };
        const timeCols = headers.map((h, i) => ({ header: h, index: i })).filter(c => c.header.includes(":"));

        for (let i = 1; i < lines.length; i++) {
            if (!lines[i].trim()) continue;
            const row = lines[i].split(',');
            if (row.length < headers.length) continue;
            const id = row[0]; const grupo = row[1];
            let schedule = [];
            for (let j = 0; j < timeCols.length; j++) {
                const col = timeCols[j];
                const startTime = toMin(col.header);
                const endTime = startTime + 30; 
                let activity = "Dormir";
                if (row[col.index]) activity = row[col.index].trim();
                if (schedule.length > 0 && schedule[schedule.length - 1].act === activity) {
                    schedule[schedule.length - 1].until = endTime;
                } else {
                    schedule.push({ until: endTime, act: activity });
                }
            }
            if (schedule.length > 0 && schedule[schedule.length - 1].until < 1440) {
                 schedule.push({ until: 1440, act: "Dormir" });
            }
            parsedNodes.push({
                id: id, group: grupo, schedule: schedule,
                x: width / 2, y: height / 2,
                currentActivity: "Dormir",
                targetX: centers["Dormir"].x * width, targetY: centers["Dormir"].y * height,
                color: colorScale(grupo) 
            });
        }
        return parsedNodes;
    }

    function startSimulation() {
        resizeCanvas();
        // AHORA LEE DEL TEXTAREA
        const csvInput = document.getElementById("csv-input").value;
        let data = parseCSV(csvInput);
        
        nodes = [];
        data.forEach(realNode => {
            // MODO DEMO MULTIPLICA LOS PUNTOS X20. 
            // CAMBIA "MODO_DEMO" A FALSE ARRIBA PARA 1 A 1.
            const repeticiones = MODO_DEMO ? 20 : 1; 
            for(let i=0; i<repeticiones; i++) {
                nodes.push({
                    ...realNode, 
                    id: realNode.id + "-clone-" + i, 
                    x: (width/2) + (Math.random()*20 - 10), 
                    y: (height/2) + (Math.random()*20 - 10),
                    schedule: MODO_DEMO ? realNode.schedule.map(s => ({...s, until: s.until + (Math.random()*10 - 5)})) : realNode.schedule
                });
            }
        });

        // Ocultar Modal
        document.getElementById("data-modal").style.display = "none";

        const isMobile = width < 768;
        simulation = d3.forceSimulation(nodes)
            .alphaMin(0.001).velocityDecay(0.35) 
            .force("charge", d3.forceManyBody().strength(isMobile ? -5 : -10)) 
            .force("collide", d3.forceCollide().radius(isMobile ? 3 : 5).strength(0.8)) 
            .on("tick", render);
        startClock(60); 
    }

    function render() {
        context.fillStyle = "rgba(255, 255, 255, 0.25)"; 
        context.fillRect(0, 0, width, height);

        // --- INICIO L√ìGICA DE PUNTOS INTELIGENTES ---
        // Calcula el tama√±o ideal basado en la cantidad de gente
        let baseSize = 6; 
        const count = nodes.length;

        if (count > 50) baseSize = 5;
        if (count > 150) baseSize = 4;
        if (count > 400) baseSize = 3;
        if (count > 800) baseSize = 2;

        const isMobile = width < 768;
        const finalRadius = isMobile ? Math.max(2, baseSize - 1.5) : baseSize;
        // --- FIN L√ìGICA DE PUNTOS INTELIGENTES ---

        let hoveredNode = null;
        nodes.forEach(node => {
            node.x += (node.targetX - node.x) * 0.06;
            node.y += (node.targetY - node.y) * 0.06;
            
            context.beginPath(); 
            // Usamos el tama√±o inteligente
            context.arc(node.x, node.y, finalRadius, 0, 2 * Math.PI);
            context.fillStyle = node.color; context.fill();
            
            if (mousePos) {
                const dist = Math.hypot(mousePos.x - node.x, mousePos.y - node.y);
                if (dist < 10) hoveredNode = node;
            }
        });
        const tooltip = document.getElementById("tooltip");
        if (hoveredNode && mousePos) {
            tooltip.style.display = "block";
            tooltip.style.left = (hoveredNode.x + 15) + "px"; tooltip.style.top = (hoveredNode.y - 15) + "px";
            tooltip.innerHTML = `<strong style="color:#74b9ff">${hoveredNode.group}</strong><br>${hoveredNode.currentActivity}`;
            context.beginPath(); context.arc(hoveredNode.x, hoveredNode.y, 8, 0, 2 * Math.PI);
            context.strokeStyle = "#2d3436"; context.lineWidth = 2; context.stroke();
        } else { tooltip.style.display = "none"; }
    }

    function updatePercentages() {
        const counts = {};
        Object.keys(centers).forEach(key => counts[key] = 0);
        counts["Otras actividades"] = 0; 
        nodes.forEach(node => {
            if (counts[node.currentActivity] !== undefined) {
                counts[node.currentActivity]++;
            } else {
                counts["Otras actividades"]++;
            }
        });
        const total = nodes.length;
        Object.keys(centers).forEach(key => {
            const safeId = key.replace(/\s+/g, '-').toLowerCase();
            const el = document.getElementById(`pct-${safeId}`);
            if (el) {
                const count = counts[key] || 0;
                const percent = total > 0 ? ((count / total) * 100).toFixed(0) : 0;
                el.innerText = percent + "%";
                el.style.color = count > 0 ? "#0984e3" : "#b2bec3";
            }
        });
    }

    function startClock(delay) {
        if (clockInterval) clearInterval(clockInterval);
        const clockDiv = document.getElementById("clock");
        clockInterval = setInterval(() => {
            time += 5; if (time >= 1440) time = 0;
            let hours = Math.floor(time / 60); let mins = time % 60;
            clockDiv.innerText = `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}`;
            nodes.forEach(node => {
                const task = node.schedule.find(t => time < t.until);
                if (task) {
                    node.currentActivity = task.act;
                    if(centers[task.act]) {
                        node.targetX = centers[task.act].x * width; node.targetY = centers[task.act].y * height;
                    } else {
                        node.targetX = centers["Otras actividades"].x * width; node.targetY = centers["Otras actividades"].y * height;
                    }
                }
            });
            updatePercentages();
            simulation.alpha(0.15).restart();
        }, delay);
    }

    function setSpeed(delay, btnElement) {
        document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
        btnElement.classList.add('active');
        startClock(delay);
    }

    let mousePos = null;
    canvas.addEventListener("mousemove", e => {
        const rect = canvas.getBoundingClientRect();
        mousePos = { x: e.clientX - rect.left, y: e.clientY - rect.top };
    });
    canvas.addEventListener("mouseleave", () => mousePos = null);
    canvas.addEventListener("touchstart", e => {
        const rect = canvas.getBoundingClientRect();
        const touch = e.touches[0];
        mousePos = { x: touch.clientX - rect.left, y: touch.clientY - rect.top };
        setTimeout(() => mousePos = null, 2000);
    }, {passive: true});

    // En esta versi√≥n NO hay auto-arranque, esperamos el click del bot√≥n
</script>
</body>
</html>
